# Sign based EWMA variance of ratio control chart (EVRS control chart)
# It is similar with EVRS chart but used interpolation method to find L1 L2 

#### Find interpolation L1 L2 under ARL0=370 ####
#Use interpolation method to find L1 L2

interpolation=function(x,up,low,up_L,low_L){
  #x =p0
  #up、low = up<p0<low  ex:0.3<0.317<0.4
  #up_L、low_L = up_L<inter_L<low_L   ex:2.5995 > inter_L >2.5183
  L=up_L-(up_L-low_L)*(up-x)/(up-low) #內差法interpolation反推L
  return(round(L,4))
}

#BSN
x=c(rep(0.317,4), rep(0.316,4), rep(0.310,4))

#BG
x=c(rep(0.318,4), rep(0.316,4), rep(0.312,4))

up=rep(0.3,12)
low=rep(0.4,12)

#Find interpolation L1 under ARL=370
up_L=c(2.5995,2.5784,2.5433,2.5316, 2.5995,2.5784,2.5433,2.5316, 2.5995,2.5784,2.5433,2.5316)
low_L=c(2.5183,2.5130,2.5118,2.5111, 2.5183,2.5130,2.5118,2.5111, 2.5183,2.5130,2.5118,2.5111)

L1=c()
for(i in 1:12){
  a=interpolation(x[i],up[i],low[i],up_L[i],low_L[i])
  L1=c(L1, a)
}
L1 


#Find interpolation L2
up_L=c(2.4004,2.4489,2.4937,2.5011, 2.4004,2.4489,2.4937,2.5011, 2.4004,2.4489,2.4937,2.5011)
low_L=c(2.4777,2.5033,2.5294,2.5297, 2.4777,2.5033,2.5294,2.5297, 2.4777,2.5033,2.5294,2.5297)

L2=c()
for(i in 1:12){
  a=interpolation(x[i],up[i],low[i],up_L[i],low_L[i])
  L2=c(L2, a)
}
L2

#BSN 
#L1=c(2.5857,2.5673,2.5379,2.5281,2.5865,2.5679,2.5383,2.5283,2.5914,2.5719,2.5401,2.5296)
#L2=c(2.4135,2.4581,2.4998,2.5060,2.4128,2.4576,2.4994,2.5057,2.4081,2.4543,2.4973,2.5040)

#BG 
#L1=c(2.5849,2.5666,2.5376,2.5279,2.5865,2.5679,2.5383,2.5283,2.5898,2.5706,2.5395,2.5291)
#L2=c(2.4143,2.4587,2.5001,2.5062,2.4128,2.4576,2.4994,2.5057,2.4097,2.4554,2.4980,2.5045)


#### The ARL0 of interpolation L1 L2 under ARL0=370 ####

#BSN
lambda=0.05
n=c(4,8,16,32, 4,8,16,32, 4,8,16,32)
p=c(rep(0.317,4), rep(0.316,4), rep(0.310,4))
L1=c(2.5857,2.5673,2.5379,2.5281,2.5865,2.5679,2.5383,2.5283,2.5914,2.5719,2.5401,2.5296)
L2=c(2.4135,2.4581,2.4998,2.5060,2.4128,2.4576,2.4994,2.5057,2.4081,2.4543,2.4973,2.5040)

#BG
lambda=0.05
n=c(4,8,16,32, 4,8,16,32, 4,8,16,32)
p=c(rep(0.318,4), rep(0.316,4), rep(0.312,4))
L1=c(2.5849,2.5666,2.5376,2.5279,2.5865,2.5679,2.5383,2.5283,2.5898,2.5706,2.5395,2.5291)
L2=c(2.4143,2.4587,2.5001,2.5062,2.4128,2.4576,2.4994,2.5057,2.4097,2.4554,2.4980,2.5045)

#Find ARL0
ARL=c()
MRL=c()
SDRL=c()
for (i in 5:8) {
  RL=EWMA_Sign_L2(n[i],L1[i],L2[i],lambda=0.05,p0=p[i],p1=p[i],ARL=370.4,set=1)
  ARL=c(ARL, RL[1])
  MRL=c(MRL, RL[2])
  SDRL=c(SDRL, RL[3])
}
output=data.frame(L1, L2, ARL, MRL, SDRL)
write.csv(output,file="C:/Users/WEIYU/Desktop/政治大學/品管研究計畫/Meeting/EWMA Sign chart/ARL0/ARL370_inter_BG.csv")


#### The ARL1 of interpolation L1 L2 under ARL0=370 ####

### BSN
# p0=0.317
# L1=c(2.5857, 2.5673, 2.5379, 2.5281)
# L2=c(2.4135, 2.4581, 2.4998, 2.5060)
# p1=c(0.0465, 0.5032, 0.6145, 0.6873, 0.7376)

# p0=0.316
# L1=c(2.5865, 2.5679, 2.5383, 2.5283)
# L2=c(2.4128, 2.4576, 2.4994, 2.5057)
# p1=c(0.0455, 0.5002, 0.6098, 0.6787, 0.7258)

# p0=0.310
# L1=c(2.5914, 2.5719, 2.5401, 2.5296)
# L2=c(2.4081, 2.4543, 2.4973, 2.5040)
# p1=c(0.0458, 0.4879, 0.5903, 0.6518, 0.6874)


### BG
# p0=0.318
# L1=c(2.5849, 2.5666, 2.5376, 2.5279)
# L2=c(2.4143, 2.4587, 2.5001, 2.5062)
# p1=c(0.0476, 0.5033, 0.6159, 0.6886, 0.7389)

# p0=0.316
# L1=c(2.5865, 2.5679, 2.5383, 2.5283)
# L2=c(2.4128, 2.4576, 2.4994, 2.5057)
# p1=c(0.0457, 0.4998, 0.6069, 0.6756, 0.7215)

# p0=0.312
# L1=c(2.5898, 2.5706, 2.5395, 2.5291)
# L2=c(2.4097, 2.4554, 2.4980, 2.5045)
# p1=c(0.0483, 0.4859, 0.5849, 0.6438, 0.6779)


p0=0.316
L1=c(2.5865, 2.5679, 2.5383, 2.5283)
L2=c(2.4128, 2.4576, 2.4994, 2.5057)
p1=c(0.0457, 0.4998, 0.6069, 0.6756, 0.7215)


lambda=0.05
n=c(4,8,16,32)
ARL1=c()
for (j in 1:4){
  for (p1 in c(0.0457, 0.4998, 0.6069, 0.6756, 0.7215) ) {
    RL=EWMA_Sign_L2(n=n[j],L1=L1[j],L2=L2[j],lambda=0.05,p0=p0,p1=p1,set=1)
    ARL1=c(ARL1, round(RL[1],4))
  }
}
matrix=matrix(ARL1, nrow=5, ncol=4, byrow=F)
path=paste0('C:/Users/WEIYU/Desktop/政治大學/品管研究計畫/Meeting/EWMA Sign chart/ARL1/ARL370/ARL1_inter_BG_p0_',p0,'.csv')
write.csv(matrix,file=path)



#### Find interpolation L1 L2 under ARL0=200 ####
interpolation=function(x,up,low,up_L,low_L){
  #x =p0
  #up、low = up<p0<low  ex:0.3<0.317<0.4
  #up_L、low_L = up_L<inter_L<low_L   ex:2.5995 > inter_L >2.5183
  L=up_L-(up_L-low_L)*(up-x)/(up-low) #內差法interpolation反推L
  return(round(L,4))
}

#BSN
x=c(rep(0.317,4), rep(0.316,4), rep(0.310,4))

#BG
x=c(rep(0.318,4), rep(0.316,4), rep(0.312,4))

up=rep(0.3,12)
low=rep(0.4,12)

#Find interpolation L1 under ARL=200
up_L=c(2.2974,2.2729,2.2601,2.2560, 2.2974,2.2729,2.2601,2.2560, 2.2974,2.2729,2.2601,2.2560)
low_L=c(2.2283,2.2387,2.2367,2.2314, 2.2283,2.2387,2.2367,2.2314, 2.2283,2.2387,2.2367,2.2314)



L1=c()
for(i in 1:12){
  a=interpolation(x[i],up[i],low[i],up_L[i],low_L[i])
  L1=c(L1, a)
}
L1 


#Find interpolation L2 under ARL=200
up_L=c(2.2096,2.2418,2.2661,2.2925, 2.2096,2.2418,2.2661,2.2925, 2.2096,2.2418,2.2661,2.2925)
low_L=c(2.2789,2.3081,2.3169,2.3242, 2.2789,2.3081,2.3169,2.3242, 2.2789,2.3081,2.3169,2.3242)

L2=c()
for(i in 1:12){
  a=interpolation(x[i],up[i],low[i],up_L[i],low_L[i])
  L2=c(L2, a)
}
L2

#BSN 
#L1=c(2.2857,2.2671,2.2561,2.2518,2.2863,2.2674,2.2564,2.2521,2.2905,2.2695,2.2578,2.2535)
#L2=c(2.2214,2.2531,2.2747,2.2979,2.2207,2.2524,2.2742,2.2976,2.2165,2.2484,2.2712,2.2957)

#BG 
#L1=c(2.2850,2.2667,2.2559,2.2516,2.2863,2.2674,2.2564,2.2521,2.2891,2.2688,2.2573,2.2530)
#L2=c(2.2221,2.2537,2.2752,2.2982,2.2207,2.2524,2.2742,2.2976,2.2179,2.2498,2.2722,2.2963)


#### The ARL0 of interpolation L1 L2 under ARL0=200 ####

#BSN
lambda=0.05
n=c(4,8,16,32, 4,8,16,32, 4,8,16,32)
p=c(rep(0.317,4), rep(0.316,4), rep(0.310,4))
L1=c(2.2857,2.2671,2.2561,2.2518,2.2863,2.2674,2.2564,2.2521,2.2905,2.2695,2.2578,2.2535)
L2=c(2.2214,2.2531,2.2747,2.2979,2.2207,2.2524,2.2742,2.2976,2.2165,2.2484,2.2712,2.2957)

#BG
lambda=0.05
n=c(4,8,16,32, 4,8,16,32, 4,8,16,32)
p=c(rep(0.318,4), rep(0.316,4), rep(0.312,4))
L1=c(2.2850,2.2667,2.2559,2.2516,2.2863,2.2674,2.2564,2.2521,2.2891,2.2688,2.2573,2.2530)
L2=c(2.2221,2.2537,2.2752,2.2982,2.2207,2.2524,2.2742,2.2976,2.2179,2.2498,2.2722,2.2963)

#Find ARL0
ARL=c()
MRL=c()
SDRL=c()
for (i in 1:length(n)) {
  RL=EWMA_Sign_L2(n[i],L1[i],L2[i],lambda=0.05,p0=p[i],p1=p[i],ARL=370.4,set=1)
  ARL=c(ARL, RL[1])
  MRL=c(MRL, RL[2])
  SDRL=c(SDRL, RL[3])
}
output=data.frame(L1, L2, ARL, MRL, SDRL)
write.csv(output,file="C:/Users/WEIYU/Desktop/政治大學/品管研究計畫/Meeting/EWMA Sign chart/ARL0/ARL200_inter_BG.csv")



#### The ARL1 of interpolation L1 L2 under ARL0=200 ####

### BSN
# p0=0.317
# L1=c(2.2857,2.2671,2.2561,2.2518)
# L2=c(2.2214,2.2531,2.2747,2.2979)
# p1=c(0.0465, 0.5032, 0.6145, 0.6873, 0.7376)

# p0=0.316
# L1=c(2.2863,2.2674,2.2564,2.2521)
# L2=c(2.2207,2.2524,2.2742,2.2976)
# p1=c(0.0455, 0.5002, 0.6098, 0.6787, 0.7258)

# p0=0.310
# L1=c(2.2905,2.2695,2.2578,2.2535)
# L2=c(2.2165,2.2484,2.2712,2.2957)
# p1=c(0.0458, 0.4879, 0.5903, 0.6518, 0.6874)


### BG
# p0=0.318
# L1=c(2.2850,2.2667,2.2559,2.2516)
# L2=c(2.2221,2.2537,2.2752,2.2982)
# p1=c(0.0476, 0.5033, 0.6159, 0.6886, 0.7389)

# p0=0.316
# L1=c(2.2863,2.2674,2.2564,2.2521)
# L2=c(2.2207,2.2524,2.2742,2.2976)
# p1=c(0.0457, 0.4998, 0.6069, 0.6756, 0.7215)

# p0=0.312
# L1=c(2.2891,2.2688,2.2573,2.2530)
# L2=c(2.2179,2.2498,2.2722,2.2963)
# p1=c(0.0483, 0.4859, 0.5849, 0.6438, 0.6779)




p0=0.316
L1=c(2.2863,2.2674,2.2564,2.2521)
L2=c(2.2207,2.2524,2.2742,2.2976)
p1=c(0.0457, 0.4998, 0.6069, 0.6756, 0.7215)



lambda=0.05
n=c(4,8,16,32)
ARL1=c()
for (j in 1:4){
  for (p1 in c(0.0457, 0.4998, 0.6069, 0.6756, 0.7215) ) {
    RL=EWMA_Sign_L2(n=n[j],L1=L1[j],L2=L2[j],lambda=0.05,p0=p0,p1=p1,set=1)
    ARL1=c(ARL1, round(RL[1],4))
  }
}
matrix=matrix(ARL1, nrow=5, ncol=4, byrow=F)
path=paste0('C:/Users/WEIYU/Desktop/政治大學/品管研究計畫/Meeting/EWMA Sign chart/ARL1/ARL200/ARL1_inter_BG_p0_',p0,'.csv')
write.csv(matrix,file=path)


